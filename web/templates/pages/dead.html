{{define "content"}}
<div class="mb-8 flex items-center justify-between">
    <div>
        <h2 class="text-3xl font-bold text-white">Dead Letter Queue</h2>
        <p class="text-gray-400 mt-1">{{.count}} dead jobs</p>
    </div>
    <div class="flex gap-2">
        {{if gt .count 0}}
        <button onclick="retryAll()" class="px-4 py-2 bg-teal-500 text-white rounded-lg text-sm hover:bg-teal-600 transition">Retry All</button>
        <button onclick="purgeAll()" class="px-4 py-2 bg-red-500/10 text-red-400 rounded-lg text-sm hover:bg-red-500/20 transition">Purge All</button>
        {{end}}
    </div>
</div>

<div class="bg-dark-800 rounded-xl border border-gray-700/50 overflow-hidden">
    <table class="w-full">
        <thead>
            <tr class="border-b border-gray-700/50">
                <th class="text-left px-6 py-3 text-xs font-medium text-gray-400 uppercase">ID</th>
                <th class="text-left px-6 py-3 text-xs font-medium text-gray-400 uppercase">Type</th>
                <th class="text-left px-6 py-3 text-xs font-medium text-gray-400 uppercase">Error</th>
                <th class="text-left px-6 py-3 text-xs font-medium text-gray-400 uppercase">Retries</th>
                <th class="text-left px-6 py-3 text-xs font-medium text-gray-400 uppercase">Created</th>
                <th class="text-left px-6 py-3 text-xs font-medium text-gray-400 uppercase">Actions</th>
            </tr>
        </thead>
        <tbody>
            {{range .jobs}}
            <tr class="border-b border-gray-700/30 hover:bg-dark-700/50">
                <td class="px-6 py-4 text-sm font-mono text-teal-400">
                    <a href="/dashboard/jobs/{{.ID}}" class="hover:underline">{{truncate .ID 8}}</a>
                </td>
                <td class="px-6 py-4 text-sm">{{.Type}}</td>
                <td class="px-6 py-4 text-sm text-red-400 max-w-xs truncate">{{.Error}}</td>
                <td class="px-6 py-4 text-sm text-gray-400">{{.RetryCount}}</td>
                <td class="px-6 py-4 text-sm text-gray-400">{{formatTime .CreatedAt}}</td>
                <td class="px-6 py-4 text-sm">
                    <button onclick="retryJob('{{.ID}}')" class="text-teal-400 hover:text-teal-300 mr-3">Retry</button>
                    <button onclick="deleteJob('{{.ID}}')" class="text-red-400 hover:text-red-300">Delete</button>
                </td>
            </tr>
            {{else}}
            <tr>
                <td colspan="6" class="px-6 py-8 text-center text-gray-500">No dead jobs</td>
            </tr>
            {{end}}
        </tbody>
    </table>
</div>

<script>
function retryJob(id) {
    fetch('/api/v1/jobs/' + id + '/retry', { method: 'POST' })
        .then(r => r.json())
        .then(() => location.reload());
}
function deleteJob(id) {
    if (!confirm('Delete this job permanently?')) return;
    fetch('/api/v1/jobs/' + id, { method: 'DELETE' })
        .then(() => location.reload());
}
function retryAll() {
    if (!confirm('Retry all dead jobs?')) return;
    // Will use retry-dead endpoint
    location.reload();
}
function purgeAll() {
    if (!confirm('Permanently delete all dead jobs?')) return;
    fetch('/api/v1/dead', { method: 'DELETE' })
        .then(r => r.json())
        .then(() => location.reload());
}
</script>
{{end}}
